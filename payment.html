<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembayaran - Sports Field Rental</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/space-theme.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Metode Pembayaran</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i> Silakan lakukan pembayaran ke salah satu nomor berikut:
                        </div>
                        
                        <!-- E-Wallet Section -->
                        <div class="payment-method mb-4">
                            <h5><i class="fas fa-mobile-alt text-success me-2"></i> E-Wallet</h5>
                            <div class="border rounded p-3 bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>No. Rekening:</strong> <span class="fs-4 fw-bold text-primary">12345678</span>
                                    </div>
                                    <div>
                                        <span class="badge bg-success">Aktif 24 Jam</span>
                                    </div>
                                </div>
                                <small class="text-muted">OVO, DANA, LinkAja, GoPay</small>
                            </div>
                        </div>
                        
                        <!-- Bank Transfer Section -->
                        <div class="payment-method mb-4">
                            <h5><i class="fas fa-university text-primary me-2"></i> Transfer Bank</h5>
                            <div class="border rounded p-3 bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>No. Rekening:</strong> <span class="fs-4 fw-bold text-primary">12345678</span>
                                    </div>
                                    <div>
                                        <span class="badge bg-primary">Semua Bank</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- QRIS Section -->
                        <div class="payment-method mb-4">
                            <h5><i class="fas fa-qrcode text-info me-2"></i> QRIS</h5>
                            <div class="border rounded p-3 bg-light">
                                <div class="text-center">
                                    <img src="https://via.placeholder.com/200x200?text=QRIS+QR+Code" alt="QRIS QR Code" class="img-fluid mb-2" style="max-width: 200px;">
                                    <p>Scan QR code untuk pembayaran menggunakan aplikasi e-wallet atau bank yang mendukung QRIS</p>
                                    <small class="text-muted">QRIS didukung oleh berbagai aplikasi seperti GoPay, OVO, DANA, LinkAja, dan bank-bank lainnya</small>
                                </div>
                            </div>
                        </div>

                        <!-- Upload Bukti Pembayaran -->
                        <div class="upload-section mt-5">
                            <h5><i class="fas fa-upload me-2"></i> Upload Bukti Pembayaran</h5>
                            <form id="paymentForm">
                                <div class="mb-3">
                                    <label for="bookingId" class="form-label">ID Booking</label>
                                    <input type="text" class="form-control" id="bookingId" placeholder="Masukkan ID booking Anda" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="paymentMethod" class="form-label">Metode Pembayaran</label>
                                    <select class="form-select" id="paymentMethod" required>
                                        <option value="">Pilih metode pembayaran</option>
                                        <option value="ewallet">E-Wallet (12345678)</option>
                                        <option value="bank_transfer">Transfer Bank (12345678)</option>
                                        <option value="qris">QRIS</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="paymentAmount" class="form-label">Jumlah Pembayaran</label>
                                    <input type="number" class="form-control" id="paymentAmount" placeholder="Masukkan jumlah pembayaran" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="proofUpload" class="form-label">Upload Bukti Pembayaran</label>
                                    <input type="file" class="form-control" id="proofUpload" accept="image/*" required>
                                    <div class="form-text">Format: JPG, PNG, maksimal 5MB</div>
                                </div>
                                
                                <button type="submit" class="btn btn-success w-100 py-2">
                                    <i class="fas fa-paper-plane me-2"></i> Kirim Bukti Pembayaran
                                </button>
                            </form>
                        </div>
                        
                        <!-- Panduan Pembayaran -->
                        <div class="guide-section mt-4">
                            <h5><i class="fas fa-question-circle me-2"></i> Panduan Pembayaran</h5>
                            <ol>
                                <li>Lakukan pembayaran ke nomor rekening <strong>12345678</strong></li>
                                <li>Simpan bukti pembayaran (screenshoot/nota)</li>
                                <li>Upload bukti pembayaran di atas</li>
                                <li>Tunggu konfirmasi dari admin (maksimal 1x24 jam)</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <a href="booking.html" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i> Kembali ke Booking</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
        // Pre-fill booking ID from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const bookingIdFromUrl = urlParams.get('bookingId');
        if (bookingIdFromUrl) {
            document.getElementById('bookingId').value = bookingIdFromUrl;
        }

        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Ambil nilai-nilai dari form
            const bookingId = document.getElementById('bookingId').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const paymentAmount = document.getElementById('paymentAmount').value;
            const proofUpload = document.getElementById('proofUpload').files[0];

            if (!proofUpload) {
                alert('Silakan upload bukti pembayaran terlebih dahulu.');
                return;
            }

            // Create payment record
            const paymentRecord = {
                id: Date.now().toString(),
                bookingId: bookingId,
                userName: localStorage.getItem('userName') || 'Unknown User',
                userEmail: localStorage.getItem('userEmail') || 'unknown@example.com',
                userId: localStorage.getItem('userEmail'), // Associate payment with user
                paymentMethod: paymentMethod,
                amount: parseInt(paymentAmount),
                proofFile: proofUpload.name, // In real app, this would be uploaded to server
                status: 'pending',
                submittedAt: new Date().toISOString(),
                confirmedAt: null,
                rejectedAt: null,
                rejectionReason: null
            };

            // Save to localStorage
            let pendingPayments = JSON.parse(localStorage.getItem('pendingPayments')) || [];
            pendingPayments.push(paymentRecord);
            localStorage.setItem('pendingPayments', JSON.stringify(pendingPayments));

            alert(`Bukti pembayaran untuk booking ${bookingId} telah dikirim dan status booking telah diperbarui. Silakan tunggu konfirmasi dari admin.`);

            // Reset form
            document.getElementById('paymentForm').reset();

            // Redirect to booking history page
            setTimeout(() => {
                window.location.href = 'booking-history.html';
            }, 2000);
        });

        // Function to update booking status in localStorage
        function updateBookingStatus(bookingId, newStatus) {
            // Get existing bookings
            let bookings = JSON.parse(localStorage.getItem('bookings')) || [];

            // Find the booking by ID and update its status
            const bookingIndex = bookings.findIndex(booking => booking.id === bookingId);
            if (bookingIndex !== -1) {
                // Update status and payment confirmation date
                bookings[bookingIndex].status = newStatus;
                bookings[bookingIndex].paymentConfirmedAt = new Date().toISOString();

                // Save updated bookings back to localStorage
                localStorage.setItem('bookings', JSON.stringify(bookings));
            }
        }
    </script>
</body>
</html>